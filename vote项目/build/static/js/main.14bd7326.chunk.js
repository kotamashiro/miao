(this.webpackJsonpvotefrontend=this.webpackJsonpvotefrontend||[]).push([[0],{237:function(e,t,n){},387:function(e,t,n){},389:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(35),s=n.n(a),i=(n(237),n(19)),o=n.n(i),u=n(39),l=n(37),j=n(50),b=n(44),d=n.n(b),h=Object(r.createContext)();h.displayName="UserContext";var p=h;var O=n(57),f=n(393),m=n(394),x=n(65),v=n(9);var g=function(e){return function(e){e=Object(l.g)(),Object(r.useContext)(p);var t=Object(O.b)();function n(){return(n=Object(u.a)(o.a.mark((function n(r){var c,a;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:c=r.username,a=r.password,d.a.post("/account/login",{name:c,password:a}).then((function(n){t({type:"user-info",user:n.data}),e.push("/home")})).catch((function(e){alert(e.toString())}));case 3:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return Object(v.jsxs)(f.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:function(e){return n.apply(this,arguments)},children:[Object(v.jsx)(f.a.Item,{name:"username",rules:[{required:!0,message:"Please input your Username!"}],children:Object(v.jsx)(m.a,{placeholder:"Username"})}),Object(v.jsx)(f.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"}],children:Object(v.jsx)(m.a,{type:"password",placeholder:"Password"})}),Object(v.jsx)(f.a.Item,{children:Object(v.jsx)(x.a,{type:"primary",htmlType:"submit",className:"login-form-button",children:"Log in"})})]})}(e.history)},y=n(11),w=n(392),k=n(227);var I=function(){var e=Object(l.g)();function t(){return(t=Object(u.a)(o.a.mark((function t(n){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,d.a.post("/account/register",{name:n.name,password:n.password,gender:n.gender,email:n.email,avatar:a[0].response.url});case 3:alert("\u6ce8\u518c\u6210\u529f"),e.push("/login"),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0.toString());case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}var n=Object(r.useState)([]),c=Object(y.a)(n,2),a=c[0],s=c[1],i=function(){var e=Object(u.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.url){e.next=5;break}return e.next=4,new Promise((function(e){var n=new FileReader;n.readAsDataURL(t.originFileObj),n.onload=function(){return e(n.result)}}));case 4:n=e.sent;case 5:(r=new Image).src=n,window.open(n).document.write(r.outerHTML);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(v.jsxs)(f.a,{name:"register",onFinish:function(e){return t.apply(this,arguments)},children:[Object(v.jsx)(f.a.Item,{name:"name",label:"Name",children:Object(v.jsx)(m.a,{})}),Object(v.jsx)(f.a.Item,{name:"password",label:"Password",children:Object(v.jsx)(m.a.Password,{})}),Object(v.jsx)(f.a.Item,{name:"email",label:"E-mail",children:Object(v.jsx)(m.a,{})}),Object(v.jsx)(f.a.Item,{name:"gender",label:"Gender",children:Object(v.jsx)(m.a,{})}),Object(v.jsx)(k.a,{rotate:!0,children:Object(v.jsx)(w.a,{action:"/upload",listType:"picture-card",fileList:a,onChange:function(e){var t=e.fileList;s(t)},onPreview:i,children:a.length<1&&"+ \u5934\u50cf"})}),Object(v.jsx)(f.a.Item,{children:Object(v.jsx)(x.a,{type:"primary",htmlType:"submit",children:"Register"})})]})},N=n(396),C=n(397);function S(){var e=Object(l.g)(),t=Object(O.c)((function(e){return e.user})),n=Object(O.c)((function(e){return e.tryLogin})),c=Object(O.b)();return Object(r.useEffect)((function(){Object(u.a)(o.a.mark((function r(){return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=2;break}return r.abrupt("return");case 2:n&&e.push("/login"),t||c({type:"get-user-info"});case 4:case"end":return r.stop()}}),r)})))()}),[t,n]),Object(v.jsxs)("div",{className:"chice",children:[Object(v.jsxs)("section",{children:[Object(v.jsxs)("div",{className:"singleChice",children:[Object(v.jsx)("img",{src:"signal.png",className:"imga"}),Object(v.jsxs)(j.b,{to:"/create",children:[" ",Object(v.jsx)(x.a,{type:"primary",block:!0,children:"\u521b\u5efa\u5355\u9009"})]})]}),Object(v.jsxs)("div",{className:"multiChice",children:[Object(v.jsx)("img",{src:"mult.png",className:"imgb"}),Object(v.jsx)(j.b,{to:"/create?multiSelect",children:Object(v.jsx)(x.a,{type:"primary",block:!0,children:"\u521b\u5efa\u591a\u9009"})})]})]}),Object(v.jsxs)("div",{className:"footer",children:[Object(v.jsxs)("div",{className:"footleft",children:[Object(v.jsx)(N.a,{style:{color:"#1890ff"}}),Object(v.jsx)(j.b,{to:"/home",children:"\u521b\u5efa"})]}),Object(v.jsxs)("div",{className:"footright",children:[Object(v.jsx)(C.a,{}),Object(v.jsx)(j.b,{to:"/my",children:"\u6211\u7684"})]})]})]})}var F=n(2);var L=n(391),P=n(395),R=n(398),U=n(399),T=n(72),D=n.n(T);function E(){var e=new URLSearchParams(Object(l.h)().search),t=Object(l.g)();function n(){return(n=Object(u.a)(o.a.mark((function n(r){var c;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,d.a.post("/vote/create",Object(F.a)(Object(F.a)({},r),{},{multiSelect:e.has("multiSelect")}));case 3:c=n.sent.data,t.push("/vote/"+c.id),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),alert(n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))).apply(this,arguments)}return Object(v.jsxs)(f.a,{name:"basic",initialValues:{remember:!0},onFinish:function(e){return n.apply(this,arguments)},children:[Object(v.jsx)(f.a.Item,{label:"Title",name:"title",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6295\u7968\u6807\u9898"}],children:Object(v.jsx)(m.a,{placeholder:"\u8bf7\u8f93\u5165\u6295\u7968\u6807\u9898"})}),Object(v.jsx)(f.a.Item,{label:"Description",name:"desc",rules:[{required:!1,message:"\u8bf7\u8f93\u5165\u6295\u7968\u63cf\u8ff0"}],children:Object(v.jsx)(m.a,{placeholder:"\u8bf7\u8f93\u5165\u6295\u7968\u63cf\u8ff0"})}),Object(v.jsx)(f.a.List,{name:"options",initialValue:["",""],children:function(e,t,n){var r=t.add,c=t.remove;n.errors;return Object(v.jsxs)(v.Fragment,{children:[e.map((function(t,n){return Object(v.jsxs)(f.a.Item,{label:0===n?"Options":"",required:!1,children:[Object(v.jsx)(f.a.Item,Object(F.a)(Object(F.a)({},t),{},{noStyle:!0,children:Object(v.jsx)(m.a,{placeholder:"\u6295\u7968\u9009\u9879",style:{width:"60%"}})})),e.length>1?Object(v.jsx)(R.a,{className:"dynamic-delete-button",onClick:function(){return c(t.name)}}):null]},t.key)})),Object(v.jsx)(f.a.Item,{children:Object(v.jsx)(x.a,{type:"dashed",onClick:function(){return r()},style:{width:"60%"},icon:Object(v.jsx)(U.a,{}),children:"Add Option"})})]})}}),Object(v.jsx)(f.a.Item,{initialValue:D()().add(1,"days"),label:"Deadline",name:"deadline",children:Object(v.jsx)(L.a,{format:"YYYY-MM-DD",showTime:{format:"HH:mm"}})}),Object(v.jsx)(f.a.Item,{initialValue:!1,name:"anonymous",valuePropName:"checked",children:Object(v.jsx)(P.a,{children:"Anonymous"})}),Object(v.jsx)(f.a.Item,{initialValue:!1,name:"restricted",valuePropName:"checked",children:Object(v.jsx)(P.a,{children:"Restricted"})}),Object(v.jsx)(f.a.Item,{children:Object(v.jsx)(x.a,{type:"primary",htmlType:"submit",children:"Submit"})})]})}var M=n(13),V=Object.create(null);var q=function(e){if(e in V)return V[e];throw function(e){return d.a.get("/vote/get/"+e)}(e).then((function(t){V[e]=t.data}))},A=n(224),H=n.n(A),Y=n(225),B=n.n(Y),J=n(228);function G(){var e=Object(l.i)(),t=Object(l.g)(),n=q(e.params.id),c=n.vote,a=n.options,s=Object(r.useState)(a),i=Object(y.a)(s,2),j=i[0],b=i[1];Object(r.useEffect)((function(){b(a)}),[a]);var p=Object(r.useContext)(h).userInfo;function O(){return(O=Object(u.a)(o.a.mark((function e(n,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=3;break}return t.push("/login"),e.abrupt("return");case 3:if(r){e.next=9;break}return e.next=6,d.a.post("/vote/voteup/"+n);case 6:console.log("ok"),e.next=12;break;case 9:return e.next=11,d.a.post("/vote/cancel/"+n);case 11:console.log("cancel");case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(r.useEffect)((function(){if(c.deadline>(new Date).toISOString()){var e=H()({});return e.emit("select room",c.id),e.on("voting info",(function(e){console.log(e),b(e)})),function(){return e.disconnect()}}}),[c.id]);var f=Object(r.useMemo)((function(){var e=j.reduce((function(e,t){return e.push.apply(e,Object(M.a)(t.Users)),e}),[]);return B()(e,"id")}),[j]);return Object(v.jsxs)("div",{children:[Object(v.jsx)("h1",{children:c.title}),Object(v.jsx)("h2",{children:c.desc}),j.map((function(e,t){var n=e.Users.some((function(e){return p&&e.id===p.id}));return Object(v.jsxs)("div",{children:[Object(v.jsxs)("div",{onClick:function(){return function(e,t){return O.apply(this,arguments)}(e.id,n)},children:[e.content,"----",n?"\u2705":"","---- (",e.Users.length,"\u7968) ---- (",(e.Users.length/f.length*100).toFixed(2),"%)",Object(v.jsx)(J.a,{percent:(e.Users.length/f.length*100).toFixed(2),showInfo:!1})]}),!c.anonymous&&Object(v.jsx)("div",{children:e.Users.map((function(e,t){return Object(v.jsx)("span",{className:"avatar",style:{display:"inline-block",width:20,height:20,borderRadius:"9999px",border:"1px solid"},children:e.name.slice(0,1).toUpperCase()},t)}))})]},t)}))]})}var _=n(147);n(386);function z(){var e=Object(r.useState)({row:[],count:10}),t=Object(y.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)([]),s=Object(y.a)(a,2),i=s[0],b=s[1];!function(){var e=Object(l.g)(),t=Object(O.c)((function(e){return e.user})),n=Object(O.c)((function(e){return e.tryLogin})),c=Object(O.b)();Object(r.useEffect)((function(){Object(u.a)(o.a.mark((function r(){return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=2;break}return r.abrupt("return");case 2:n&&e.push("/login"),t||c({type:"get-user-info"});case 4:case"end":return r.stop()}}),r)})))()}),[t,n])}();if(!i)return Object(v.jsx)("div",{children:"loading..."});function h(e){var t=e.key,n=e.index,r=e.style;return n>=i.length?Object(v.jsx)("div",{style:r,children:"loading..."},t):Object(v.jsx)("div",{style:r,children:Object(v.jsx)(j.b,{to:"/vote/"+i[n].id,children:i[n].title})},t)}return Object(v.jsxs)("div",{className:"My",children:[Object(v.jsx)(_.b,{isRowLoaded:function(e){var t=e.index;return!!i[t]},loadMoreRows:function(e){var t=e.startIndex,n=e.stopIndex;return d.a.get("/vote/myvotes?startIndex=".concat(t,"&stopIndex=").concat(n)).then((function(e){c(e.data),i.splice.apply(i,[t,0].concat(Object(M.a)(e.data.rows))),b(Object(M.a)(i))})).catch((function(e){console.log(e)}))},rowCount:n.count,children:function(e){var t=e.onRowsRendered,r=e.registerChild;return Object(v.jsx)(_.a,{children:function(e){var c=e.width,a=e.height;return Object(v.jsx)(_.c,{onRowsRendered:t,ref:r,width:c,height:a,rowCount:n.count,rowHeight:20,rowRenderer:h})}})}}),Object(v.jsxs)("div",{className:"footer",children:[Object(v.jsxs)("div",{className:"footleft",children:[Object(v.jsx)(N.a,{}),Object(v.jsx)(j.b,{to:"/home",children:"\u521b\u5efa"})]}),Object(v.jsxs)("div",{className:"footright",children:[Object(v.jsx)(C.a,{style:{color:"#1890ff"}}),Object(v.jsx)(j.b,{to:"/my",children:"\u6211\u7684"})]})]})]})}n(387);var K=function(){var e=Object(l.g)(),t=Object(O.c)((function(e){return e.user})),n=Object(O.b)();function c(){return(c=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n({type:"logout"});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(r.useEffect)((function(){n({type:"get-user-info"})}),[]),Object(v.jsx)(p.Provider,{value:{userInfo:t},children:Object(v.jsxs)("div",{className:"App",children:[Object(v.jsx)("div",{className:"appheader",children:t?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)("span",{children:["\u6b22\u8fce\uff0c",t.name]}),Object(v.jsxs)("div",{className:"backout",children:[Object(v.jsx)("button",{onClick:function(){e.go(-1)},children:"\u8fd4\u56de"}),Object(v.jsx)("button",{onClick:function(){return c.apply(this,arguments)},children:"\u767b\u51fa"})]})]}):Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(j.c,{to:"/login",children:"\u767b\u9646"}),Object(v.jsx)(j.c,{to:"/register",children:"\u6ce8\u518c"})]})}),Object(v.jsxs)(l.d,{children:[Object(v.jsx)(l.b,{path:"/",exact:!0,children:Object(v.jsx)(l.a,{to:"/home"})}),Object(v.jsx)(l.b,{path:"/home",component:S}),Object(v.jsx)(l.b,{path:"/login",component:g}),Object(v.jsx)(l.b,{path:"/register",component:I}),Object(v.jsx)(l.b,{path:"/create",component:E}),Object(v.jsx)(l.b,{path:"/my",component:z}),Object(v.jsx)(l.b,{path:"/vote/:id",component:G,children:Object(v.jsx)(r.Suspense,{fallback:"loading...",children:Object(v.jsx)(G,{})})})]})]})})},Q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,400)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),r(e),c(e),a(e),s(e)}))},W=n(108),X=n(231),Z=n(81),$=o.a.mark(se),ee=o.a.mark(ie),te=o.a.mark(oe),ne=o.a.mark(ue),re=Object(X.a)(),ce={user:null,votes:{},tryLogin:!1},ae=Object(W.c)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"user-info":return Object(F.a)(Object(F.a)({},e),{},{user:t.user});case"remove-user-info":return Object(F.a)(Object(F.a)({},e),{},{user:null});case"try-login-failed":return Object(F.a)(Object(F.a)({},e),{},{tryLogin:!0});default:return e}}),Object(W.a)(re));function se(e){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.a.get("/account/userinfo");case 3:return t=e.sent,e.next=6,Object(Z.a)({type:"user-info",user:t.data});case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(0),e.next=12,Object(Z.a)({type:"try-login-failed"});case 12:case"end":return e.stop()}}),$,null,[[0,8]])}function ie(e){var t;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,d.a.post("/account/login",{name:e.name,password:e.password});case 3:return t=n.sent,n.next=6,Object(Z.a)({type:"user-info",user:t.data});case 6:n.next=11;break;case 8:throw n.prev=8,n.t0=n.catch(0),n.t0;case 11:case"end":return n.stop()}}),ee,null,[[0,8]])}function oe(e){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.get("/account/logout");case 2:return e.sent,e.next=5,Object(Z.a)({type:"remove-user-info"});case 5:case"end":return e.stop()}}),te)}function ue(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Z.b)("get-user-info",se);case 2:return e.next=4,Object(Z.b)("login",ie);case 4:return e.next=6,Object(Z.b)("logout",oe);case 6:case"end":return e.stop()}}),ne)}re.run(ue);n(388);s.a.render(Object(v.jsx)(c.a.StrictMode,{children:Object(v.jsx)(j.a,{children:Object(v.jsx)(O.a,{store:ae,children:Object(v.jsx)(K,{})})})}),document.getElementById("root")),Q()}},[[389,1,2]]]);
//# sourceMappingURL=main.14bd7326.chunk.js.map